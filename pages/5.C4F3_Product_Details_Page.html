<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Detail Page – Coffee Marketplace</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .glass {
      background: rgba(255, 248, 231, 0.15);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid rgba(255, 248, 231, 0.3);
      border-radius: 1rem;
      transition: all 0.3s ease-in-out;
    }
    .soft-shadow {
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }
    .product-image {
      transition: transform 0.4s ease, box-shadow 0.4s ease;
    }
    .product-image:hover {
      transform: scale(1.05);
      box-shadow: 0 0 30px rgba(255, 248, 231, 0.6);
    }
    .feature-card {
      transition: all 0.3s ease-in-out;
    }
    .feature-card:hover {
      background: rgba(255, 248, 231, 0.25);
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(255, 248, 231, 0.4);
    }
    @keyframes gradientMove {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .gradient-button {
      position: relative;
      overflow: hidden;
      border-radius: 1rem;
      background: linear-gradient(to right, #A0522D, #D2691E, #8B4513, #A0522D);
      background-size: 400% 400%;
      animation: gradientMove 4s linear infinite;
      color: white;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    .gradient-button:hover {
      transform: scale(1.03);
      box-shadow: 0 0 20px rgba(160, 82, 45, 0.7), 0 0 30px rgba(210, 105, 30, 0.5);
    }
    .tab-content { display: none; }
    .tab-active { display: block; }
    .star { color: #FFD700; font-size: 1rem; }
    .star-empty { color: #FFF8E7aa; font-size: 1rem; }
    body { background: linear-gradient(to top right, #6F4E37, #D2B48C); }
  </style>
</head>
<body class="min-h-screen font-sans p-4 sm:p-6">

<div class="container mx-auto">

  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

    <!-- Product Image + Carousel -->
    <div class="glass soft-shadow p-6">
      <div class="relative w-full h-96 mb-6 overflow-hidden rounded-xl">
        <div id="carousel" class="flex transition-transform duration-500 touch-pan-x">
          <div class="w-full flex-shrink-0 bg-white/20 flex items-center justify-center text-xl text-white/80 product-image">Image 1</div>
          <div class="w-full flex-shrink-0 bg-white/20 flex items-center justify-center text-xl text-white/80 product-image">Image 2</div>
          <div class="w-full flex-shrink-0 bg-white/20 flex items-center justify-center text-xl text-white/80 product-image">Image 3</div>
        </div>
        <button onclick="prevSlide()" class="absolute left-2 top-1/2 transform -translate-y-1/2 bg-white/30 text-[#6F4E37] p-2 rounded-full hover:bg-white/50 transition">&#10094;</button>
        <button onclick="nextSlide()" class="absolute right-2 top-1/2 transform -translate-y-1/2 bg-white/30 text-[#6F4E37] p-2 rounded-full hover:bg-white/50 transition">&#10095;</button>
      </div>

      <div class="space-y-4">
        <div class="flex items-center justify-between p-4 bg-white/10 border border-white/20 rounded-lg feature-card">
          <span class="text-white/80">Feature A</span>
          <span class="text-[#D2691E] font-semibold">Spec</span>
        </div>
        <div class="flex items-center justify-between p-4 bg-white/10 border border-white/20 rounded-lg feature-card">
          <span class="text-white/80">Feature B</span>
          <span class="text-[#D2691E] font-semibold">Spec</span>
        </div>
        <div class="flex items-center justify-between p-4 bg-white/10 border border-white/20 rounded-lg feature-card">
          <span class="text-white/80">Feature C</span>
          <span class="text-[#D2691E] font-semibold">Spec</span>
        </div>
      </div>
    </div>

    <!-- Product Info + Tabs -->
    <div class="glass soft-shadow p-6 flex flex-col justify-between">
      <div class="space-y-4">
        <div id="productTitle" class="w-full p-4 text-2xl font-bold text-white bg-white/10 rounded-xl text-center shadow-inner">Product Title</div>
        <div id="vendorName" class="w-full p-3 text-lg text-white/80 bg-white/10 rounded-lg text-center">Vendor Name</div>
        <div id="productPrice" class="w-full p-3 text-xl font-semibold text-[#D2691E] bg-white/10 rounded-lg text-center">$Pricing</div>

        <div class="flex justify-center items-center space-x-1">
          <span class="star">&#9733;</span>
          <span class="star">&#9733;</span>
          <span class="star">&#9733;</span>
          <span class="star">&#9733;</span>
          <span class="star-empty">&#9733;</span>
        </div>

        <div class="flex space-x-2 justify-center mt-4">
          <button onclick="showTab('description')" class="px-4 py-2 bg-white/10 text-white rounded-xl">Description</button>
          <button onclick="showTab('features')" class="px-4 py-2 bg-white/10 text-white rounded-xl">Features</button>
          <button onclick="showTab('reviews')" class="px-4 py-2 bg-white/10 text-white rounded-xl">Reviews</button>
        </div>

        <div id="description" class="tab-content p-4 bg-white/10 rounded-xl text-white/80 mt-2">
          Product description goes here. Highlight key features, flavors, or unique selling points.
        </div>
        <div id="features" class="tab-content p-4 bg-white/10 rounded-xl text-white/80 mt-2">
          Feature A, B, C details and specifications.
        </div>
        <div id="reviews" class="tab-content p-4 bg-white/10 rounded-xl text-white/80 mt-2">
          Customer reviews and ratings.
        </div>
      </div>

      <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3 mt-6">
        <button id="requestPartnershipBtn" class="flex-1 gradient-button py-3 text-base">Request Partnership</button>
      </div>
    </div>

  </div>
</div>

<script>
  let currentSlide = 0;
  const slides = document.querySelectorAll('#carousel > div');

  function showSlide(index) {
    currentSlide = (index + slides.length) % slides.length;
    document.getElementById('carousel').style.transform = `translateX(-${currentSlide * 100}%)`;
  }

  function nextSlide() { showSlide(currentSlide + 1); }
  function prevSlide() { showSlide(currentSlide - 1); }

  // Touch support
  let startX = 0;
  const carousel = document.getElementById('carousel');

  carousel.addEventListener('touchstart', e => startX = e.touches[0].clientX);
  carousel.addEventListener('touchend', e => {
    let endX = e.changedTouches[0].clientX;
    if (endX - startX > 50) prevSlide();
    else if (startX - endX > 50) nextSlide();
  });

  function showTab(tabId) {
    document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('tab-active'));
    document.getElementById(tabId).classList.add('tab-active');
  }

  showTab('description');

  // --- Load product by ad_id and populate page ---
  function getQueryParam(name) {
    const params = new URLSearchParams(window.location.search);
    return params.get(name);
  }

  async function fetchProduct(adId) {
    try {
      const res = await fetch(`../backend/get_product.php?ad_id=${encodeURIComponent(adId)}`);
      if (!res.ok) return null;
      const data = await res.json();
      return data && Object.keys(data).length ? data : null;
    } catch (e) {
      console.error('fetchProduct error', e);
      return null;
    }
  }

  function setCarouselImages(imageUrl) {
    const carousel = document.getElementById('carousel');
    carousel.innerHTML = '';
    if (!imageUrl) {
      const d = document.createElement('div');
      d.className = 'w-full flex-shrink-0 bg-white/20 flex items-center justify-center text-xl text-white/80 product-image';
      d.textContent = 'No Image';
      carousel.appendChild(d);
      return;
    }

    // support comma-separated images or single URL
    const imgs = imageUrl.split(',').map(s => s.trim()).filter(Boolean);
    imgs.slice(0,3).forEach(src => {
      const wrap = document.createElement('div');
      wrap.className = 'w-full flex-shrink-0 bg-white/20 flex items-center justify-center text-xl text-white/80 product-image';
      const img = document.createElement('img');
      let fixed = src;
      if (!/^https?:\/\//i.test(fixed)) {
        if (!fixed.startsWith('/')) fixed = '../' + fixed;
      }
      img.src = fixed;
      img.alt = 'Product Image';
      img.className = 'object-cover w-full h-full rounded-xl';
      wrap.appendChild(img);
      carousel.appendChild(wrap);
    });
  }

  (async function initProductPage(){
    const adId = getQueryParam('ad_id');
    if (!adId) return; // nothing to do

    const p = await fetchProduct(adId);
    if (!p) {
      document.getElementById('productTitle').textContent = 'Product not found';
      document.getElementById('vendorName').textContent = '';
      document.getElementById('productPrice').textContent = '';
      document.getElementById('description').textContent = 'This product could not be found or is not approved.';
      setCarouselImages(null);
      return;
    }

    document.getElementById('productTitle').textContent = p.product_name || '';
    document.getElementById('vendorName').textContent = p.vendor_name || '';
    document.getElementById('productPrice').textContent = p.price ? `$${p.price}` : '';
    document.getElementById('description').textContent = p.description || '';
    // features — if you store structured features, adapt here. For now reuse description excerpt
    document.getElementById('features').textContent = p.features || '';
    setCarouselImages(p.image_url || '');

    // Wire Request Partnership button to open the partnership form (no params)
    const reqBtn = document.getElementById('requestPartnershipBtn');
    if (reqBtn) {
      reqBtn.addEventListener('click', () => {
        window.location.href = '../pages/11.C4F3_Request_Partnership_Page.html';
      });
    }
  })();
</script>

</body>
</html>
